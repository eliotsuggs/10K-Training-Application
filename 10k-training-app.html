<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 10K Training Plan with AI Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A dashboard-style SPA. The primary navigation is a week selector (buttons 16 down to 1). This updates a detailed 7-day grid view for the selected week. Above the grid, a bar chart visualizes the total weekly running minutes for the entire 16-week plan, with the selected week's bar highlighted. This structure was chosen because it provides both a high-level overview of the training progression (the chart) and easy access to specific daily tasks (the grid), which is ideal for a long-term plan. It avoids overwhelming the user by presenting one week at a time while keeping the full context visible. Gemini API is integrated to provide weekly coaching tips and on-demand workout suggestions for rest days, making the plan more dynamic and supportive. -->
    <!-- Visualization & Content Choices: 
        - Report Info: 16-week training schedule. Goal: Organize & Explore. Viz/Presentation: Interactive 7-day grid (HTML/Tailwind) for weekly details. Interaction: Click a week selector button to update the grid content. Justification: A grid is a clear, standard way to show a weekly schedule.
        - Report Info: Progression of running effort. Goal: Show Change Over Time. Viz/Presentation: Bar Chart (Chart.js/Canvas) showing total running minutes per week. Interaction: The bar corresponding to the selected week is highlighted. Justification: A bar chart is excellent for comparing discrete values (weekly totals) and visualizing the build-up in training intensity.
        - Report Info: Need for coaching/variety. Goal: Provide personalized guidance. Viz/Presentation: Gemini-generated text in dedicated sections/modals. Interaction: Buttons trigger API calls for weekly tips or cross-training ideas. Justification: Leverages LLM to add value beyond the static plan, offering dynamic, context-aware advice.
        - Library/Method: Chart.js for the chart, Vanilla JS for all interactions and state management, Tailwind CSS for styling. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF8;
            color: #3f3c3a;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
                max-height: 350px;
            }
        }
        .week-button.active {
            background-color: #D6A2E8;
            color: #ffffff;
            font-weight: 600;
        }
        .week-button {
            transition: all 0.2s ease-in-out;
        }
        .day-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #ai-modal { display: none; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #D6A2E8;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Battleship 10K Training Plan</h1>
            <p class="mt-2 text-lg text-gray-500">Your AI-powered 16-week journey to the finish line.</p>
        </header>

        <main>
            <section id="visualization" class="mb-8 md:mb-12">
                <div class="bg-white rounded-2xl p-4 sm:p-6 shadow-sm">
                    <h2 class="text-xl font-bold text-gray-700 mb-1">Weekly Running Volume</h2>
                    <p class="text-gray-500 mb-4">This chart shows your total planned running minutes each week. Use the buttons below to select a week and see the detailed plan.</p>
                    <div class="chart-container">
                        <canvas id="trainingPlanChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="plan-details">
                <div class="bg-white rounded-2xl p-4 sm:p-6 shadow-sm">
                    <div id="week-selector" class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3 text-center">Select a Week (16 = Start, 1 = Race Week)</h3>
                        <div class="flex flex-wrap justify-center gap-2">
                        </div>
                    </div>
                    
                    <div id="week-display">
                        <h2 id="week-title" class="text-2xl md:text-3xl font-bold text-center mb-2 text-gray-800"></h2>
                        <p id="week-dates" class="text-center text-gray-500 mb-4"></p>
                        
                        <div class="text-center mb-6">
                            <button id="get-insights-btn" class="bg-purple-400 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300">
                                ‚ú® Get Weekly Insights & Tips
                            </button>
                        </div>

                        <div id="ai-insights-container" class="hidden mt-6 bg-purple-50 p-4 rounded-lg">
                            <h3 class="font-bold text-purple-800 text-lg mb-2">Your AI Coach Says...</h3>
                            <div id="ai-insights-content" class="text-gray-700"></div>
                        </div>

                        <div id="daily-plan-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-4 mt-6">
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-12 text-gray-400 text-sm">
            <p>Plan by iamwithoutlimits.com | Interactive dashboard created to help you succeed.</p>
        </footer>
    </div>
    
    <div id="ai-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
             <h3 class="font-bold text-gray-800 text-xl mb-4">Workout Suggestions</h3>
             <div id="ai-modal-content"></div>
             <button id="close-modal-btn" class="mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Close</button>
        </div>
    </div>


    <script>
        const trainingData = [
            { week: 16, date: '8/3/2025', monday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '5 min walk warm up + 7 x 2 min easy run + 1 min walk + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 6 x 1 min easy run with 30s walk breaks + 8 x 30s easy run with 1 min walk breaks + 4 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 15, date: '8/10/2025', monday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '5 min walk warm up + 7 x 2 min easy run + 1 min walk + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 6 x 1 min easy run with 30s walk breaks + 8 x 30s easy run with 1 min walk breaks + 4 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 14, date: '8/17/2025', monday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '5 min walk warm up + 7 x 2 min easy run + 1 min walk + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 6 x 1 min easy run with 30s walk breaks + 8 x 30s easy run with 1 min walk breaks + 4 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 12 x 1 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 13, date: '8/24/2025', monday: '5 min walk warm up + 10 x 1 min easy run with 1 min walk in between + 5 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '5 min walk warm up + 7 x 2 min easy run + 1 min walk + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 6 x 1 min easy run with 30s walk breaks + 8 x 30s easy run with 1 min walk breaks + 4 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 12 x 1 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 12, date: '8/31/2025', monday: '3 min easy pace run warm up + 3 min walk + 10 x 2 min easy run + 1 min walk breaks in between + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '3 min easy pace run warm up + 3 min walk + 6 x 3 min easy run + 2 min walk breaks in between + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '3 min easy pace run warm up + 3 min walk + 20 x 1 min easy pace run + 30s walk breaks in between + 4 min walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '4 min walk warm up + 15 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 11, date: '9/7/2025', monday: '3 min easy pace run warm up + 3 min walk + 10 x 2 min easy run + 1 min walk breaks in between + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '3 min easy pace run warm up + 3 min walk + 6 x 3 min easy run + 2 min walk breaks in between + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '3 min easy pace run warm up + 3 min walk + 20 x 1 min easy pace run + 30s walk breaks in between + 4 min walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 15 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 10, date: '9/14/2025', monday: '3 min easy pace run warm up + 3 min walk + 10 x 2 min easy run + 1 min walk breaks in between + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '3 min easy pace run warm up + 3 min walk + 6 x 3 min easy run + 2 min walk breaks in between + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '3 min easy pace run warm up + 3 min walk + 20 x 1 min easy pace run + 30s walk breaks in between + 4 min walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '6 min walk warm up + 15 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 9, date: '9/21/2025', monday: '3 min easy pace run warm up + 3 min walk + 10 x 2 min easy run + 1 min walk breaks in between + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '3 min easy pace run warm up + 3 min walk + 6 x 3 min easy run + 2 min walk breaks in between + 4 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '3 min easy pace run warm up + 3 min walk + 20 x 1 min easy pace run + 30s walk breaks in between + 4 min walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '7 min walk warm up + 15 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 8, date: '9/28/2025', monday: '10 min easy pace run + 3 min walk + 10 minutes easy pace run + 3 min walk + 10 minutes easy pace run + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '2 min walk + 4 x 8 minutes easy pace run + 1 min walk in between + 2 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 20 minutes easy pace run without stopping + 5 min walk + 10 minutes easy pace run without stopping + 5 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 20 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 7, date: '10/5/2025', monday: '10 min easy pace run + 3 min walk + 10 minutes easy pace run + 3 min walk + 10 minutes easy pace run + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '2 min walk + 4 x 8 minutes easy pace run + 1 min walk in between + 2 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 20 minutes easy pace run without stopping + 5 min walk + 10 minutes easy pace run without stopping + 5 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '5 min walk warm up + 20 x 2 min easy run with 1 min walk in between + 5 min walk cool down' },
            { week: 6, date: '10/12/2025', monday: '10 min easy pace run + 3 min walk + 10 minutes easy pace run + 3 min walk + 10 minutes easy pace run + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '2 min walk + 4 x 8 minutes easy pace run + 1 min walk in between + 2 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 20 minutes easy pace run without stopping + 5 min walk + 10 minutes easy pace run without stopping + 5 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '40 minutes easy pace run straight' },
            { week: 5, date: '10/19/2025', monday: '10 min easy pace run + 3 min walk + 10 minutes easy pace run + 3 min walk + 10 minutes easy pace run + 4 min walk cool down', tuesday: 'Free Day to Cross Train or Strength', wednesday: '2 min walk + 4 x 8 minutes easy pace run + 1 min walk in between + 2 min walk cool down', thursday: 'Free Day to Cross Train or Strength', friday: '5 min walk warm up + 20 minutes easy pace run without stopping + 5 min walk + 10 minutes easy pace run without stopping + 5 min walk cool down', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '45 minutes easy pace run straight' },
            { week: 4, date: '10/26/2025', monday: '30 minutes easy pace run + 6 strides + 5 min walk', tuesday: 'Free Day to Cross Train or Strength', wednesday: '10 minutes easy pace run + 4 strides + 10 minutes easy pace run + 4 strides + 10 minutes easy pace run', thursday: 'Free Day to Cross Train or Strength', friday: '45 minute walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '50 minute easy pace run straight' },
            { week: 3, date: '11/2/2025', monday: '30 minutes easy pace run + 6 strides + 5 min walk', tuesday: 'Free Day to Cross Train or Strength', wednesday: '10 minutes easy pace run + 4 strides + 10 minutes easy pace run + 4 strides + 10 minutes easy pace run', thursday: 'Free Day to Cross Train or Strength', friday: '45 minute walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '60 minute easy pace run' },
            { week: 2, date: '11/9/25', monday: '30 minutes easy pace run + 6 strides + 5 min walk', tuesday: 'Free Day to Cross Train or Strength', wednesday: '10 minutes easy pace run + 4 strides + 10 minutes easy pace run + 4 strides + 10 minutes easy pace run', thursday: 'Free Day to Cross Train or Strength', friday: '45 minute walk', saturday: '20-30 minutes optional easy run (4 min run, 1 min walk)', sunday: '40 minute easy pace run' },
            { week: 1, date: '11/16/25', monday: '30 minutes easy pace run + 6 strides + 5 min walk', tuesday: '10 minutes easy pace run + 4 strides', wednesday: 'Day Off', thursday: '20 minutes easy run', friday: 'Free Day', saturday: 'Rest', sunday: 'Battleship 10K' }
        ].reverse();

        let chart;
        let activeWeek = 16;
        
        const insightsBtn = document.getElementById('get-insights-btn');
        const insightsContainer = document.getElementById('ai-insights-container');
        const insightsContent = document.getElementById('ai-insights-content');
        const modal = document.getElementById('ai-modal');
        const modalContent = document.getElementById('ai-modal-content');
        const closeModalBtn = document.getElementById('close-modal-btn');


        function calculateRunningMinutes(workout) {
            if (typeof workout !== 'string') return 0;
            let totalMinutes = 0;
            
            const repsMatch = workout.match(/(\d+)\s*x\s*(\d+)\s*min/g);
            if(repsMatch) {
                repsMatch.forEach(match => {
                    const parts = match.match(/(\d+)/g);
                    totalMinutes += parseInt(parts[0]) * parseInt(parts[1]);
                });
            }

            const minMatch = workout.matchAll(/(\d+)\s*minutes?/g);
            for(const m of minMatch) {
                 if(!m[0].includes('x')) totalMinutes += parseInt(m[1]);
            }
            
            if (workout.includes('20 minutes easy run')) totalMinutes += 20;

            return totalMinutes;
        }

        const weeklyTotals = trainingData.map(weekData => {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const total = days.reduce((acc, day) => acc + calculateRunningMinutes(weekData[day]), 0);
            return { week: weekData.week, total: total };
        }).sort((a,b) => a.week - b.week);

        function showLoading(element) {
            element.innerHTML = '<div class="flex justify-center items-center"><div class="spinner"></div><p class="ml-4 text-gray-600">Generating AI insights...</p></div>';
        }

        async function callGemini(prompt, loadingElement, targetElement, maxRetries = 3) {
            showLoading(loadingElement);
            if(targetElement) targetElement.classList.remove('hidden');

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        loadingElement.innerHTML = text.replace(/\n/g, '<br>');
                        return;
                    } else {
                         throw new Error('Invalid response structure from API.');
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === maxRetries - 1) {
                        loadingElement.innerHTML = `<p class="text-red-500">Sorry, I couldn't get any tips right now. Please try again later.</p>`;
                        break;
                    }
                    await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, i)));
                }
            }
        }
        
        function getWeeklyInsights() {
            const weekData = trainingData.find(w => w.week === activeWeek);
            if(!weekData) return;
            
            const prompt = `You are a friendly and encouraging running coach. I am on week ${weekData.week} of a 16-week 10K training plan. This is my plan for this week:
            - Monday: ${weekData.monday}
            - Tuesday: ${weekData.tuesday}
            - Wednesday: ${weekData.wednesday}
            - Thursday: ${weekData.thursday}
            - Friday: ${weekData.friday}
            - Saturday: ${weekData.saturday}
            - Sunday: ${weekData.sunday}
            
            Please provide:
            1. A brief summary of this week's main goal (e.g., building base, increasing intensity, recovery).
            2. Two actionable tips for this specific week, focusing on things like nutrition, hydration, gear, or mental prep.
            3. A short, motivational message to keep me going.
            Format the response clearly with headings for each section.`;

            callGemini(prompt, insightsContent, insightsContainer);
        }

        function getWorkoutSuggestion() {
            const prompt = `You are a helpful fitness assistant. I'm on a 10K training plan and today is a cross-training or strength day. Please suggest three diverse workout options I can do in about 30-45 minutes. For each option, give it a title and a brief description of the exercises.
            1.  **Strength Focus:** A full-body workout that supports running.
            2.  **Low-Impact Cardio:** An option that is easy on the joints.
            3.  **Flexibility & Mobility:** Something to help with recovery and range of motion.`;
            
            modal.style.display = 'flex';
            callGemini(prompt, modalContent);
        }

        function setupChart() {
            const ctx = document.getElementById('trainingPlanChart').getContext('2d');
            const labels = weeklyTotals.map(d => `Week ${d.week}`);
            const data = weeklyTotals.map(d => d.total);

            const backgroundColors = data.map((_, i) => (weeklyTotals[i].week === activeWeek) ? '#D6A2E8' : '#e5e7eb');
            const hoverBackgroundColors = data.map((_, i) => (weeklyTotals[i].week === activeWeek) ? '#C38DDE' : '#d1d5db');

            chart = new Chart(ctx, {
                type: 'bar', data: { labels: labels, datasets: [{ label: 'Total Running Minutes', data: data, backgroundColor: backgroundColors, borderColor: '#ffffff', borderWidth: 2, borderRadius: 8, hoverBackgroundColor: hoverBackgroundColors }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, title: { display: true, text: 'Minutes' } }, x: { grid: { display: false } } }, plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { return `Total: ${context.parsed.y} minutes`; } } } } }
            });
        }

        function updateChartHighlight() {
            const backgroundColors = chart.data.datasets[0].data.map((_, i) => (weeklyTotals[i].week === activeWeek) ? '#D6A2E8' : '#e5e7eb');
            const hoverBackgroundColors = chart.data.datasets[0].data.map((_, i) => (weeklyTotals[i].week === activeWeek) ? '#C38DDE' : '#d1d5db');
            chart.data.datasets[0].backgroundColor = backgroundColors;
            chart.data.datasets[0].hoverBackgroundColor = hoverBackgroundColors;
            chart.update();
        }

        function displayWeek(weekNumber) {
            activeWeek = parseInt(weekNumber);
            insightsContainer.classList.add('hidden');
            const weekData = trainingData.find(w => w.week === activeWeek);
            if (!weekData) return;

            document.getElementById('week-title').textContent = `Week ${weekData.week}`;
            const sundayDate = new Date(weekData.date);
            const mondayDate = new Date(sundayDate);
            mondayDate.setDate(sundayDate.getDate() - 6);
            
            const options = { month: 'short', day: 'numeric' };
            document.getElementById('week-dates').textContent = `${mondayDate.toLocaleDateString('en-US', options)} - ${sundayDate.toLocaleDateString('en-US', options)}, ${sundayDate.getFullYear()}`;

            const grid = document.getElementById('daily-plan-grid');
            grid.innerHTML = '';

            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            days.forEach((day) => {
                const dayKey = day.toLowerCase();
                const plan = weekData[dayKey];
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card bg-gray-50 rounded-xl p-4 flex flex-col h-full border border-gray-200';
                
                let icon = 'üèÉ';
                if (plan.toLowerCase().includes('strength') || plan.toLowerCase().includes('cross train')) icon = 'üèãÔ∏è';
                if (plan.toLowerCase().includes('day off') || plan.toLowerCase().includes('rest')) icon = 'üò¥';
                if (plan.toLowerCase().includes('walk') && !plan.toLowerCase().includes('run')) icon = 'üö∂';
                if (plan.toLowerCase().includes('battleship 10k')) icon = 'üèÅ';
                
                let suggestionBtn = '';
                if(plan.toLowerCase().includes('strength') || plan.toLowerCase().includes('cross train')) {
                    suggestionBtn = `<button class="suggest-workout-btn mt-3 text-xs bg-purple-100 text-purple-700 font-semibold py-1 px-2 rounded-md hover:bg-purple-200">üí° Suggest a Workout</button>`;
                }

                dayCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-bold text-gray-800">${day}</h4>
                        <span class="text-2xl">${icon}</span>
                    </div>
                    <p class="text-gray-600 text-sm flex-grow">${plan}</p>
                    ${suggestionBtn}
                `;
                grid.appendChild(dayCard);
            });
            
            grid.querySelectorAll('.suggest-workout-btn').forEach(btn => {
                btn.addEventListener('click', getWorkoutSuggestion);
            });

            document.querySelectorAll('.week-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.week == activeWeek);
            });

            updateChartHighlight();
        }

        function setupWeekSelector() {
            const selector = document.querySelector('#week-selector .flex');
            for (let i = 16; i >= 1; i--) {
                const button = document.createElement('button');
                button.textContent = i;
                button.dataset.week = i;
                button.className = 'week-button h-10 w-10 rounded-full bg-gray-200 text-gray-700 font-medium';
                button.addEventListener('click', () => displayWeek(i));
                selector.appendChild(button);
            }
        }
        
        insightsBtn.addEventListener('click', getWeeklyInsights);
        closeModalBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.onload = function() {
            setupWeekSelector();
            setupChart();
            displayWeek(16);
        };
    </script>
</body>
</html>
